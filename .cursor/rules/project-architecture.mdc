---
description: 这是第一版开放平台设计方案
globs: 
alwaysApply: false
---
开放平台的意义
开放平台能够将企业的核心能力以 API 产品的形式标准化输出，降低与合作伙伴对接门槛，它支持从 REST、HTTP、WebSocket 到 LLM、MCP、Agent 等多样化的 API 能力共享，企业可以将这些能力封装为标准的 API 产品发布至 API 门户，通过网关实现统一的流量管理和安全管控，构建专属的 API 与 AI 能力市场，让合作伙伴和开发者能够便捷、安全地获取和复用这些能力，促进业务创新。
开放平台的关键意义：
1. 统一入口，为开发者提供集中的 API 访问点；
2. 简化 API 发现和使用流程；
3. 提高 API 复用率，降低重复开发成本；
4. 推动外部合作和创新。
AI 时代开放平台新的价值：
企业可以基于开放平台构建自己的 LLM、MCP 门户等，例如构建像 OpenRouter 这样的模型聚合平台，或者像 Higress MCP Marketplace 这样的 MCP 市场。
开放平台架构
image.png
核心概念
1. API 产品：多个具有业务关联的 API 的打包集合，它定义了一组可以被开发者订阅和使用的 API 服务；
2. API 门户：面向开发者的统一入口，由 API Provider 构建，提供 API 产品展示、文档浏览、APP 注册、API 产品订阅等功能；
3. 开发者：API 产品的使用者，通过门户完成注册、创建 APP、订阅 API 产品等操作；
4. APP：开发者创建的应用，拥有独立的凭证，用于调用 API 产品。
API 产品
API 管理
API 产品支持多种类型 API 的接入，包括 REST、HTTP、WebSocket、MCP、LLM、Agent API 等。管理员可以对 API 进行分组管理，并进行统一的配置维护。
文档管理
API 产品支持配置 OpenAPI Spec 接口文档，同时支持 Markdown 格式的使用说明文档，管理员可以通过在线编辑工具维护和更新文档内容。
版本管理
可选，支持 API 产品的版本控制，包括版本发布、切换和废弃管理。
Policy 管理
管理员可以为 API 产品配置统一的鉴权、流量、安全防护等策略，这些策略将作用于产品下的所有 API。
门户后台
API 产品管理
门户管理员可将 API 产品发布至门户，发布时可指定 API 产品的类别和访问权限：
1. Public：所有开发者可见、可订阅；
2. Private：具有权限的开发者可见、可订阅。
开发者管理
1. 开发者注册
门户管理员可以配置开发者注册和登录门户的方式，包括：
● 内置（默认）：用户使用账号密码注册、登录；
● OIDC：通过 OIDC 协议对接第三方身份认证服务或企业内部的认证鉴权系统，例如使用 IDaas 用户账号登录。
2. 开发者审批、撤销
开发者的注册请求可配置为手动或自动审批流程，审批通过后的开发者账号才能够正常使用，管理员也可主动撤销某一个开发者账号。
RBAC 管理
API 产品支持灵活的访问权限控制，管理员可为开发者配置 API 产品的权限范围，如 Viewer（可浏览）、Consumer（可订阅）。
APP 管理
开发者登录门户后可申请 APP，并使用 APP 订阅 API 产品，APP 的申请和 API 产品的订阅请求均可配置为后台手动审批或自动审批。管理员可主动撤销某一个 APP 或 API 订阅。
门户定制
管理员可对门户进行个性化配置，包括门户地址（提供默认地址）、布局样式、Logo 设置、主题定制、内容管理等。
可观测
管理员可查看发布至当前门户的 API 产品的整体流量、成功率、延迟等指标信息（要求网关的可观测能力能够聚合一组 API 的观测指标）。
门户前台
API 产品展示
门户提供分类展示和搜索功能，开发者可以浏览所有可见的 API 产品。每个产品展示基本信息、功能介绍、使用指南等内容。
开发者中心
集成开发者所需的核心功能：
1. 账号与应用管理：个人信息维护、APP 创建及配置；
2. 订阅管理：查看已订阅 API 产品及授权状态；
3. 开发工具：在线调试工具、多语言 SDK、示例代码等。
可观测
门户前台能够展示开发者的 API 调用信息，包括整体流量、成功率、延迟等（要求网关可观测能力能够聚合一组 APP 的观测指标）。
开发者
开发者遵循规范的接入流程：
1. 完成账号注册并等待审核；
2. 创建 APP 并获取访问凭证；
3. 浏览和订阅所需的 API 产品；
4. 下载 SDK，正式调用服务。
APP
APP 管理一组身份凭证，与消费者鉴权中的 Consumer 相近。开发者需要通过 APP 订阅 API 产品，订阅成功后该 APP 将获得 API 产品的授权。开发者可使用 APP 凭证调用 API，凭证信息支持按需更新。
业务流程
开发者门户的整体业务流程如下：

门户配置流程
1. 管理员创建门户，设置门户的基础信息，包括外观、域名、注册和审批策略；
2. 管理员创建 API 产品，配置产品内的 API 服务、接口文档和鉴权策略；
3. 管理员将 API 产品发布到门户，设置产品的分类和访问权限；
4. 管理员可查看 API 产品的订阅状态和可观测数据。
开发者注册流程
1. 开发者访问门户并选择合适的方式（账号密码/OIDC）进行注册；
2. 管理员对注册申请进行审核，设置开发者权限；
3. 开发者登录门户，浏览可见的 API 产品，查看接口文档。
应用创建和授权流程
1. 开发者申请 APP；
2. 管理员审核 APP 申请，通过后系统生成 APP 凭证。
3. 开发者选择 API 产品并提交订阅申请；
4. 管理员审核订阅申请并授予调用权限。
开发调试和运行流程
1. 开发者使用 APP 凭证，通过在线调试工具验证接口功能；
2. 开发者下载 SDK，集成 API 能力到自己的业务系统；
3. 开发者可通过门户监控 APP 的调用数据。
开放平台规划
发展路线
总体路线：开源探索、能力完善、商业化转化、持续演进。
优先通过开源方式构建一个功能完整的开放平台，快速验证市场需求，为后续商业化产品的推出打基础。

构建开源开放平台的优势：
1. 构建速度更快，试错成本更低；
2. 用户通常对开放平台有更多的定制化的能力，开源方案可提供拓展性；
3. 开源门户支持对接商业化网关的 API，管理员可使用阿里云账号登录门户后台，管理、开放云上 API；
4. 不影响 APIG 现有的 API 管理模型，不增加产品的运维负担；
5. 开放平台作为一个完全独立的模块，利于商业化产品复用。
产品演进目标
期望：根据开源版本的实践经验以及用户的需求、反馈，提炼出适用于商业化产品的开放平台的解决方案。
开放平台未来演进为：
1. 商业版上提供一个简单、易用、轻量级的门户，可理解为一个 Common Case，定制能力有限，但基本功能齐全，提供 SLA 保障。
2. 开源版涵盖商业版的所有能力，支持管理云上 API，支持一些定制化的能力，如自定义审批流等，支持用户 DIY，不承诺 SLA。
近期探索方向
现阶段一个探索的方向：
1. 寻找具有完整开放平台能力的开源产品；
2. 基于开源开放平台对接 APIG，进行 POC；
3. 复用开源门户的能力（直接复用或重写），构建 APIG 开源开放平台。
问题思考
合并 APP 和 Consumer
APP 与 Consumer 的结构相同，拥有一组身份凭证，用于调用 API，二者看似仅仅是名称上有区别，但 APP 通常被认定为门户内管理的资源，其归属于某一个开发者，当门户被删除后，所有开发者在门户上申请的 APP 都将会一起被删除。
现有的开放平台（例如 KONG、APIGEE 等）均由门户、API 产品、开发者、APP 四个新的实体组成。其中，门户、API 产品、开发者都可以在用户环境中管理，但 APP 需要获取 API 的授权，APP 凭证必须在网关上存储，这样才能让数据面感知到。
解决方案：合并 Consumer 和 APP，API 产品的鉴权方式 Consumer 保持同步。



